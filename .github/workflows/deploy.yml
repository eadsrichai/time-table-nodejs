name: Deploy to Server

on:
  # 1. ทำงานอัตโนมัติเมื่อมีการ Push ไปที่ main
  push:
    branches:
      - main

  # 2. เพิ่มปุ่มกด Run workflow แบบ Manual (เอาไว้กดเทสได้โดยไม่ต้องแก้โค้ด)
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy via SSH
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.KEY }}
          script: |
            # --- แก้ไข Path ให้ตรงกับโฟลเดอร์จริงใน Server ของคุณ ---
            cd /home/web/timetable
            
            # --- คำสั่งดึงโค้ดและอัปเดต ---
            git pull origin main
            npm install
            #node app_time_v2.js
            
            # --- คำสั่ง Restart (เปลี่ยนตามที่คุณใช้จริง) ---
            pm2 restart app_time_v2.js
            pm2 save

            
            #pm2 restart my-timetable-app || pm2 start app_time_v2.js --name "my-timetable-app"
